DROP DATABASE sosframe_db;

CREATE DATABASE sosframe_db
	DEFAULT CHARACTER SET utf8
	DEFAULT COLLATE utf8_general_ci;

USE sosframe_db;

# Set timezone to GMT for Http-date compliance
SET time_zone = '+0:00';
	
CREATE TABLE user (
	userID						INT UNSIGNED NOT NULL AUTO_INCREMENT,
	user_name					VARCHAR(60) NOT NULL,
	user_password 				VARCHAR(255) NOT NULL,
	user_email					VARCHAR(255) NOT NULL,
	user_url					VARCHAR(255),
	user_type					VARCHAR(45),
	user_activation_key			VARCHAR(255),
	user_status					VARCHAR(45),
	UNIQUE(user_email),
	PRIMARY KEY(userID)	
)
ENGINE = MyISAM;

/* Need to rethink this table */
CREATE TABLE user_history (
	historyID				INT UNSIGNED NOT NULL AUTO_INCREMENT,
	userID_FK				INT UNSIGNED NOT NULL,	
	registration_date		DATETIME,	
	last_activity			TIMESTAMP,
	PRIMARY KEY(historyID)
)
ENGINE = MyISAM;

CREATE TABLE article (
	articleID 				INT UNSIGNED NOT NULL AUTO_INCREMENT,
	article_title			VARCHAR(255),
	article_description		VARCHAR(255),
	article_body			LONGTEXT,
	article_publish_status	BOOLEAN DEFAULT 0,
	article_publish_date	DATETIME,
	article_creation_date	DATETIME NOT NULL,
	article_path			VARCHAR(333) NOT NULL,
	article_parent			INT UNSIGNED,
	etag					VARCHAR(32),
	last_modified			TIMESTAMP,
				
	UNIQUE(article_path),
	PRIMARY KEY(articleID)
)
ENGINE = MyISAM;

CREATE TABLE author (
	userID					INT UNSIGNED NOT NULL,
	articleID				INT UNSIGNED NOT NULL,
	last_modified			DATETIME,
	
	PRIMARY KEY(userID, articleID)
)
ENGINE = MyISAM;
	
delimiter |
CREATE TRIGGER update_article BEFORE UPDATE ON article
	FOR EACH ROW
		BEGIN			
			SET NEW.last_modified=NOW();
			SET NEW.etag=MD5(FLOOR(RAND() * 100));
		END;
|

CREATE TRIGGER insert_article BEFORE INSERT ON article
	FOR EACH ROW
		BEGIN			
			SET NEW.last_modified=NOW();
			SET NEW.etag=MD5(FLOOR(RAND() * 100));
		END;
|
delimiter ;


INSERT INTO user (user_name, user_password, user_email, user_type)
	VALUES ("Craig Spencer", "Tester", "test@email.com", "Admin");
SET @last_id_user = LAST_INSERT_ID();

INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-1", "Health Article Title 1", 
	"This is the description - Health article 1", "Body Text", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());

INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());

INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO user (user_name, user_password, user_email, user_type)
	VALUES ("John Smith", "Password", "none@email.com", "USER");
SET @last_id_user = LAST_INSERT_ID();

INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());


INSERT INTO article (article_path, article_title, article_description,
	article_body, article_publish_date, article_creation_date)
VALUES ("Health/Health-Article-Title-2", "Health Article Title 2",
	"Description - Health Article Title 2", "Text Body 2", NOW(), NOW());
INSERT INTO author (userID, articleID) VALUES(@last_id_user, LAST_INSERT_ID());





/*
("Health/Health-Article-Title-3", "Health Article Title 3", "Blah blah blah", NOW()),
("Technology/Tech-Article-Title-1", "Tech Article Title 1", "Blah blah blah", NOW()),
("Technology/Tech-Article-Title-2", "Tech Article Title 2", "Blah blah blah", NOW()),
("Technology/Coding/Coding-Article-Title", "Tech Article Title 3", "Blah blah blah", NOW()),
("Money/Money-Article-Title-1", "Money Article Title 1", "Blah blah blah", NOW()),
("Money/Money-Article-Title-2", "Money Article Title 2", "Blah blah blah", NOW()),
("Money/Money-Article-Title-3", "Money Article Title 3", "Blah blah blah", NOW()),
("Music/Music-Article-Title-1", "Music Article Title 1", "Blah blah blah", NOW()),
("Music/Music-Article-Title-2", "Music Article Title 2", "Blah blah blah", NOW()),
("Music/Music-Article-Title-3", "Music Article Title 3", "Blah blah blah", NOW()),
("Success/Success-Article-Title-1", "Success Article Title 1", "Blah blah blah", NOW()),
("Success/Success-Article-Title-2", "Success Article Title 2", "Blah blah blah", NOW()),
("Success/Success-Article-Title-3", "Success Article Title 3", "Blah blah blah", NOW()),
("Success/Success-Article-Title-4", "Success Article Title 4", "Blah blah blah", NOW()),
("Health/Health-Article-Title-4", "Health Article Title 4", "Blah blah blah", NOW());

/*